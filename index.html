<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>VegaHub.pro - Watch Movies & Web Series Online in HD</title> 

  <meta name="keywords" content="bollyflix, netflix, amazon prime, hdhub4u, vegamovies, mp4moviez, filmywap, filmyzila, bollyflix, vegamovies, download, movies, web series, watch online, hindi, bollywood, hollywood" />

  <meta property="og:locale" content="hi_IN" />
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="VegaHub.pro" />

  <meta property="og:title" content="VegaHub.pro | HD Movies & Web Series Download" />

  <meta property="og:description" content="Watch and download the latest **Netflix, Amazon Prime, Hdhub4u, Vegamovies, Mp4moviez, Filmywap, Filmyzila, Bollyflix** content. Get Bollywood, Hollywood, and South Web Series in high definition, instantly." />

  <meta property="og:image" content="https://raw.githubusercontent.com/virat119/images/refs/heads/main/1764700903623.jpg" />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />

  <meta property="og:url" content="https://virat119.github.io/Vegahub/" />

  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="VegaHub.pro | HD Movies & Web Series Download" />
  <meta name="twitter:description" content="Watch and download the latest Netflix, Amazon Prime, Hdhub4u, Vegamovies, Mp4moviez, Filmywap, Filmyzila, Bollyflix content. Get Bollywood, Hollywood, and South Web Series in high definition, instantly." />
  <meta name="twitter:image" content="https://raw.githubusercontent.com/virat119/images/refs/heads/main/1764700903623.jpg" />
  
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" rel="stylesheet">
</head>



<style>
    /* ------------------------------------- */
    /* √∞≈∏≈°‚Ç¨ THEME & COLOR VARIABLES (Dark Mode Default) */
    /* ------------------------------------- */
    :root {
        /* General Colors */
        --bg-color: #000;
        --text-color: #fff;
        --card-bg: #1a1a1a; 
        --input-bg: #111;
        --input-border: #333;
        --logo-text-color: white;
        --cat-btn-bg: #222;

        /* Dynamic Primary Colors (Category-based) */
        --dynamic-primary: #ff1493; /* Default Pink */
        --dynamic-primary-gradient-end: #ff4500;
        --dynamic-primary-shadow: rgba(255, 20, 147, 0.4);
    }

    /* √∞≈∏‚Äô¬° Light Mode (Day Mode) Fixes */
    body.light-mode {
        --bg-color: #f0f0f0 !important; 
        --text-color: #111111; 
        --card-bg: #ffffff; 
        --input-bg: #ffffff; 
        --input-border: #cccccc; 
        --logo-text-color: #111111;
        --cat-btn-bg: #e0e0e0; 
    }

    /* Global & Header */
    body { 
        background: var(--bg-color) !important; 
        color: var(--text-color); 
        font-family: 'Segoe UI', sans-serif; 
        margin:0; 
    }
    .header { 
        background: #0d0d0d; 
        padding: 14px 0; 
        z-index:50; 
        box-shadow:0 5px 20px rgba(0,0,0,0.6); 
        position: unset; 
        width: 100%;
    } 
    .header.light-mode {
        background: #e0e0e0; 
        box-shadow: 0 5px 20px rgba(0,0,0,0.1);
    }
    .logo { 
        font-weight: 900; 
        font-size: 24px; 
        letter-spacing: 2px; 
        color: var(--logo-text-color); 
    } 
    .logo-pink {
        color: var(--dynamic-primary);
    }
    
    /* Theme Toggle Icon Styling */
    #theme-toggle {
        background: var(--cat-btn-bg);
        color: var(--text-color);
        width: 38px;
        height: 38px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        font-size: 16px;
        transition: all 0.2s;
        border: 2px solid var(--input-border);
        cursor: pointer;
        line-height: 1;
        outline: none; 
    }
    #theme-toggle:hover {
        border-color: var(--dynamic-primary);
        color: var(--dynamic-primary);
    }
    
    .search { background: var(--input-bg); border-radius: 50px; padding: 12px 50px 12px 20px; font-size: 14px; width:100%; border:2px solid var(--input-border); color: var(--text-color);} 
    .search:focus { outline:none; border-color:var(--dynamic-primary); box-shadow:0 0 15px var(--dynamic-primary-shadow); }
    
    /* √∞≈∏‚Äù¬• TELEGRAM ICON FIX: Positioning refined for better spacing */
    .tg-icon { 
        position: absolute; 
        top: 50%; 
        right: 8px; /* Corner par rakha */
        transform: translateY(-50%); 
        background:#0088cc; 
        width:44px; 
        height:44px; 
        border-radius:50%; 
        display:flex; 
        align-items:center; 
        justify-content:center; 
        box-shadow:0 4px 15px rgba(0,136,204,0.8); 
        z-index:9999; 
    } 
    .header .max-w-5xl {
        position: relative; /* Essential for .tg-icon absolute positioning */
    }
    /* Home page adjustment for TG icon, to move it away from theme toggle */
    #home-page .tg-icon {
        right: 55px; /* Theme toggle se thoda left shift kiya */
    }

    /* Movie Card Styling (Unchanged) */
    .card { 
        background:var(--card-bg); 
        border-radius:10px; 
        overflow:hidden; 
        border:1px solid var(--input-border); 
        cursor:pointer; 
        height:310px; 
        position:relative; 
        transition: all 0.3s ease-in-out;
        box-shadow: 0 2px 8px rgba(0,0,0,0.6); 
    }
    .card:hover {
        transform: translateY(-4px); 
        box-shadow: 0 0 0 2px var(--dynamic-primary), 0 8px 20px var(--dynamic-primary-shadow); 
        border-color: transparent;
    }
    .thumb { height:220px; width:100%; object-fit:cover; } 
    .quality { 
        position:absolute; top:6px; left:6px; 
        background:linear-gradient(45deg, var(--dynamic-primary), var(--dynamic-primary-gradient-end)); 
        padding:2px 7px; border-radius:5px; font-size:8px; font-weight:bold; box-shadow:0 1px 3px rgba(0,0,0,0.6); 
    }
    .rating-badge {
        position: absolute;
        top: 6px;
        right: 6px;
        background: rgba(0, 0, 0, 0.7);
        padding: 2px 7px;
        border-radius: 5px;
        font-size: 10px;
        font-weight: bold;
        color: white;
        z-index: 10;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.6);
    }

    /* Category Buttons (Unchanged) */
    .cat-btn { background:var(--cat-btn-bg); padding:7px 14px; border-radius:18px; font-weight:600; margin:3px; transition:all 0.2s; font-size:13px; } 
    .cat-btn.active, .cat-btn:hover { background:var(--dynamic-primary); transform:translateY(-2px); color:white;}

    /* Pagination Buttons (Unchanged) */
    .page-btn { background: var(--cat-btn-bg); padding: 5px 9px; border-radius: 4px; font-size: 12px; font-weight: 600; transition: all 0.2s; margin: 0 1px; } 
    .page-btn.active { background: var(--dynamic-primary); color: white; }
    
    /* DETAIL PAGE - Premium Look Changes (Unchanged) */
    .detail-container { max-width:950px; margin:20px auto; padding:15px; }
    .detail-poster { width:100%; max-width:202px; border-radius:12px; border:3px solid var(--dynamic-primary); box-shadow:0 8px 20px var(--dynamic-primary-shadow); } 
    .detail-title { 
        font-size:28px; 
        font-weight:900; 
        text-align:center; 
        color:var(--dynamic-primary); 
        margin:15px 0; 
        text-shadow:0 0 15px var(--dynamic-primary-shadow); 
    }

    /* Info Grid (Unchanged) */
    .info-grid { display:grid; grid-template-columns:1fr 1fr; gap:8px; background:var(--bg-color); padding:15px; border-radius:10px; margin-bottom:15px; border: 1px solid var(--input-border);}
    .info-item { background:var(--input-bg); padding:8px; border-radius:6px; }
    .info-label { color:var(--dynamic-primary-gradient-end); font-weight:bold; font-size:11px; } 
    .info-value { color:var(--text-color); font-size:13px; margin-top:1px; }

    /* Synopsis Box (Unchanged) */
    .synopsis-box { background:var(--bg-color); padding:15px; border-radius:10px; line-height:1.6; margin-bottom:15px; border-left:3px solid var(--dynamic-primary); }
    .synopsis-box h3 { font-size:17px; margin-bottom:8px; color:var(--dynamic-primary); } 
    .synopsis-box p { font-size:14px; color:var(--text-color); } 

    /* √∞≈∏≈í≈∏ Video Player & Controls (MODIFIED: Increased Border and Shadow) */
    .player-wrapper { 
        position: relative; 
        background: #000; 
        /* Border color is now a dynamic gradient for a more 'color-full' effect */
        border: 8px solid transparent; /* <--- MODIFIED: Border thickness increased */
        border-image: linear-gradient(45deg, var(--dynamic-primary), var(--dynamic-primary-gradient-end)) 1; 
        border-radius: 18px; 
        margin-bottom: 25px; 
        box-shadow: 0 0 80px var(--dynamic-primary-shadow), 0 15px 40px rgba(0,0,0,0.9); /* <--- MODIFIED: Shadow increased for more glow */
        overflow: hidden; 
        transition: all 0.3s ease-in-out; 
    }
    .player-wrapper:hover {
        /* Slightly deeper shadow on hover */
        box-shadow: 0 0 100px var(--dynamic-primary), 0 15px 45px var(--dynamic-primary-shadow); /* <--- MODIFIED: Hover Shadow increased */
        transform: translateY(-2px);
    }
    
    /* √¢¬¨‚Ä†√Ø¬∏ Iframe Container (MODIFIED: Height Increased) */
    .video-container { 
        position:relative; 
        padding-bottom:65%; /* <--- MODIFIED: Increased from 56.25% to 65% for a taller video player */
        height:0; 
        overflow:hidden; 
    }
    .video-container iframe { 
        position:absolute; 
        top:0; 
        left:0; 
        width:100%; 
        height:100%; 
        border:none; 
    }
    
    /* Server Tabs (Design Updated - Smaller) */
    .server-tabs {
        display: flex;
        flex-wrap: wrap;
        gap: 8px; /* Added gap for spacing */
        justify-content: center;
        margin-bottom: 20px;
    }
    .server-tab { 
        background:var(--cat-btn-bg); 
        padding:6px 10px; /* Reduced padding */
        border-radius:14px; /* Reduced border radius */
        font-weight:600; 
        font-size:11px; /* Reduced font size */
        transition:all 0.2s; 
        border: 1px solid var(--input-border);
    } 
    .server-tab.active { 
        background:var(--dynamic-primary); 
        box-shadow:0 0 8px var(--dynamic-primary-shadow); 
        color:white; 
        border-color: var(--dynamic-primary);
    }

    /* Download Buttons (Design Updated - Grid and smaller) */
    #download-buttons {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); /* Display in 2 columns (or more) */
        gap: 10px; /* Gap between buttons */
        margin-top: 15px;
    }
    .download-btn { 
        display:block; 
        background:linear-gradient(to right,var(--dynamic-primary),var(--dynamic-primary-gradient-end)); 
        color:white; 
        padding:8px; /* Reduced padding */
        margin:0; /* Removed margin to use grid gap */
        border-radius:4px; /* Reduced border radius */
        text-align:center; 
        font-weight:bold; 
        font-size:12px; /* Reduced font size */
        text-decoration:none; 
        box-shadow:0 3px 8px var(--dynamic-primary-shadow); 
        transition:all 0.3s; 
    }
    .download-btn:hover { 
        transform:translateY(-1px); 
        box-shadow:0 5px 12px var(--dynamic-primary-shadow); 
    }

    /* Back Button (Small) */
    .back-btn { background:#333; padding:5px 12px; border-radius:18px; display:inline-block; font-weight:bold; font-size:12px; transition:all 0.2s; }
    .back-btn:hover { background:var(--dynamic-primary); }
    
    /* Loader Style (Unchanged) */
    .spinner { border-left-color: var(--dynamic-primary); }

    /* Empty State Styles (Unchanged) */
    .empty-state {
        text-align: center;
        padding: 50px 20px;
        margin-top: 20px;
        border: 2px dashed var(--input-border);
        border-radius: 10px;
        color: var(--text-color);
    }
    .empty-state h3 {
        font-size: 20px;
        font-weight: 700;
        margin-bottom: 10px;
        color: var(--dynamic-primary);
    }
    .empty-state p {
        margin-bottom: 20px;
        font-size: 16px;
    }
    .request-btn {
        background: #0088cc;
        color: white;
        padding: 10px 20px;
        border-radius: 30px;
        font-weight: bold;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        transition: background 0.2s;
    }
    .request-btn:hover {
        background: #006b9b;
    }

    /* NEW: Social Share Section Styling */
    .share-container {
        padding: 15px;
        border-top: 1px solid var(--input-border);
        margin-top: 20px;
        text-align: center;
    }
    .share-btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 38px;
        height: 38px;
        border-radius: 50%;
        margin: 0 5px;
        color: white;
        font-size: 16px;
        transition: transform 0.2s;
    }
    .share-btn:hover {
        transform: scale(1.1);
    }
    /* Specific Colors */
    .share-whatsapp { background-color: #25D366; }
    .share-telegram { background-color: #0088cc; }
    .share-twitter { background-color: #1DA1F2; }
    .share-facebook { background-color: #1877F2; }
    
    /* JS BLOCK OVERLAY CSS */
    #js-block-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: #222;
        color: white;
        z-index: 99999;
        display: flex;
        align-items: center;
        justify-content: center;
        text-align: center;
        padding: 20px;
        box-sizing: border-box;
    }
    #js-block-overlay h2 {
        color: var(--dynamic-primary); 
        font-size: 24px;
        margin-bottom: 10px;
    }

    
    @media (max-width:576px) {
      .card { height:260px; }
      .thumb { height:190px; }
      .detail-title { font-size:22px; }
      .detail-poster { max-width:160px; }
      .info-grid { grid-template-columns:1fr; }
    }
    

/* üì∏ --- AUTO SCREENSHOT DISPLAY CSS (FIXED FOR STACKING) --- üì∏ */

.screenshot-display-container {
    margin: 30px 0;
    padding: 10px 0;
    border-top: 1px solid var(--border-color, #333); 
    border-bottom: 1px solid var(--border-color, #333);
}

.screenshot-heading {
    text-align: center;
    font-size: 20px;
    font-weight: 600;
    margin-bottom: 15px;
}

/* Images ‡§ï‡•ã ‡§è‡§ï-‡§¶‡•Ç‡§∏‡§∞‡•á ‡§ï‡•á ‡§®‡•Ä‡§ö‡•á ‡§¶‡§ø‡§ñ‡§æ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è Flexbox ‡§∏‡•á‡§ü‡§Ö‡§™ */
.screenshot-images-wrapper {
    display: flex;
    flex-direction: column; /* üëá ‡§Ø‡§π ‡§∏‡•Å‡§®‡§ø‡§∂‡•ç‡§ö‡§ø‡§§ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à ‡§ï‡§ø ‡§µ‡•á ‡§è‡§ï ‡§ï‡•á ‡§®‡•Ä‡§ö‡•á ‡§è‡§ï ‡§Ü‡§è‡§Ç */
    gap: 15px; /* ‡§á‡§Æ‡•á‡§ú‡•á‡§∏ ‡§ï‡•á ‡§¨‡•Ä‡§ö ‡§ï‡•Ä ‡§¶‡•Ç‡§∞‡•Ä ‡§¨‡§¢‡§º‡§æ ‡§¶‡•Ä ‡§ó‡§à */
    align-items: center; /* ‡§á‡§Æ‡•á‡§ú‡•á‡§∏ ‡§ï‡•ã ‡§∏‡•á‡§Ç‡§ü‡§∞ ‡§Æ‡•á‡§Ç ‡§∞‡§ñ‡§§‡§æ ‡§π‡•à */
    padding: 0 5px;
}

.movie-screenshot-img {
    width: 100%; 
    max-width: 600px; /* ‡§Ü‡§™ ‡§á‡§∏ max-width ‡§ï‡•ã ‡§¨‡§¢‡§º‡§æ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç */
    height: auto;
    border-radius: 6px;
    object-fit: cover;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
    transition: transform 0.3s ease; 
}

/* ‡§Ö‡§ó‡§∞ ‡§Ü‡§™ ‡§Ö‡§≠‡•Ä ‡§≠‡•Ä ‡§Æ‡§≤‡•ç‡§ü‡•Ä‡§™‡§≤ ‡§ï‡•â‡§≤‡§Æ ‡§®‡§π‡•Ä‡§Ç ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç, ‡§§‡•ã Media Queries ‡§ï‡•ã ‡§π‡§ü‡§æ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç ‡§Ø‡§æ ‡§ê‡§∏‡•á ‡§∏‡•á‡§ü ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç: */
@media (min-width: 640px) {
    .movie-screenshot-img {
        width: 100%; /* ‡§π‡§Æ‡•á‡§∂‡§æ ‡§´‡•Å‡§≤-‡§µ‡§ø‡§°‡•ç‡§• (‡§Æ‡•à‡§ï‡•ç‡§∏-‡§µ‡§ø‡§°‡•ç‡§• ‡§§‡§ï) ‡§π‡•Ä ‡§∞‡§π‡•á‡§ó‡§æ */
    }
}

 /* Cast/Crew Images CSS - Mobile Optimized */

/* Container for horizontal scrolling */
.cast-images-container {
    display: flex;
    overflow-x: auto; /* Horizontal scrolling for cast */
    gap: 12px; /* Gap kam kiya */
    padding: 10px 0;
    padding-bottom: 15px; 
}

/* Individual Cast/Crew Item */
.cast-item {
    flex: 0 0 auto;
    text-align: center;
    width: 80px; /* Width kam kiya */
}

/* Cast Image (Circular) */
.cast-image {
    width: 80px; /* Size kam kiya */
    height: 80px; /* Size kam kiya */
    object-fit: cover;
    border-radius: 50%; 
    border: 2px solid var(--dynamic-primary-gradient-end); /* Border kam kiya */
    margin-bottom: 5px;
    transition: transform 0.2s ease;
}

/* Cast Name */
.cast-name {
    font-size: 11px; /* Font size kam kiya */
    font-weight: 600;
    color: var(--text-color);
    line-height: 1.2;
    margin-bottom: 2px;
    /* Ensure name doesn't wrap awkwardly on small screens */
    white-space: nowrap; 
    overflow: hidden;
    text-overflow: ellipsis; 
}

/* Cast Role/Character */
.cast-role {
    font-size: 9px; /* Font size kam kiya */
    color: #999;
    line-height: 1.1;
    white-space: nowrap; 
    overflow: hidden;
    text-overflow: ellipsis; 
}

/* Optional: Tablet/Desktop adjustments (Media Query) */
@media (min-width: 640px) {
    .cast-item {
        width: 100px;
    }
    .cast-image {
        width: 100px;
        height: 100px;
        border-width: 3px;
    }
    .cast-name {
        font-size: 12px;
    }
    .cast-role {
        font-size: 10px;
    }
}

    
</style>
</head>
<body>

<noscript>
  <div id="js-block-overlay">
    <div>
      <i class="fas fa-exclamation-triangle text-yellow-500 text-5xl mb-4"></i>
      <h2>JavaScript Required!</h2>
      <p class="text-lg">VegaHub.pro ‡§¶‡•á‡§ñ‡§®‡•á, ‡§∏‡•ç‡§ü‡•ç‡§∞‡•Ä‡§Æ ‡§ï‡§∞‡§®‡•á ‡§î‡§∞ ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è JavaScript ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§π‡•à‡•§</p>
      <p class="mt-4">‡§ï‡•É‡§™‡§Ø‡§æ ‡§Ö‡§™‡§®‡•á ‡§¨‡•ç‡§∞‡§æ‡§â‡§ú‡§º‡§∞ ‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó‡•ç‡§∏ ‡§Æ‡•á‡§Ç JavaScript ‡§ï‡•ã ‡§∏‡§ï‡•ç‡§∑‡§Æ (Enable) ‡§ï‡§∞‡•á‡§Ç‡•§</p>
    </div>
  </div>
</noscript>
<div id="home-page">
  <header class="header">
    <div class="max-w-5xl mx-auto px-4 flex justify-between items-center">
      <h1 class="logo">Vega<span class="logo-pink">Hub</span>.pro</h1>
      
      <button id="theme-toggle" class="transition" title="Toggle Light/Dark Mode"><i class="fas fa-sun"></i></button>
      
      <a href="https://t.me/vegahubb" target="_blank" class="tg-icon">
        <img src="https://upload.wikimedia.org/wikipedia/commons/8/82/Telegram_logo.svg" class="w-6 h-6">
      </a>
    </div>
  </header>

  <div>
    <div class="max-w-4xl mx-auto px-4 mt-6">
      <div class="relative">
        <input type="text" id="search" placeholder="Search Movie Name..." class="search">
        <i class="fas fa-search absolute right-5 top-3 text-pink-500 text-base"></i>
      </div>
    </div>

<div class="max-w-4xl mx-auto px-4 mt-6 flex flex-wrap justify-center gap-2">
  <button class="cat-btn active" data-cat="all">All</button>
  <button class="cat-btn" data-cat="bollywood">Bollywood</button>
  <button class="cat-btn" data-cat="hollywood">Hollywood</button>
  <button class="cat-btn" data-cat="south">South</button>
  <button class="cat-btn" data-cat="web">Web Series</button>
  
  <button class="cat-btn" data-cat="adult">Adult</button>
  <button class="cat-btn" data-cat="netflix">Netflix</button>
</div>



    <div class="max-w-4xl mx-auto px-4 py-6">
      <div id="grid" class="grid grid-cols-2 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-7 gap-4"></div>
      <div id="empty-search-state" class="empty-state hidden">
          <i class="fas fa-search-minus text-4xl mb-4 text-gray-400"></i>
          <h3>Movie Not Found!</h3>
          <p>The movie you searched for is not yet available in our database.</p>
          <a href="https://t.me/vegahubpro" target="_blank" class="request-btn">
              <i class="fab fa-telegram-plane mr-2"></i> Request Movie on Telegram
          </a>
      </div>
      <div id="loading-state" class="empty-state">
          <i class="fas fa-spinner fa-spin text-4xl mb-4 text-pink-500"></i>
          <h3>Loading Movies...</h3>
          <p>Fetching the latest data from the server.</p>
      </div>
      <div class="flex justify-center gap-1 mt-8 flex-wrap" id="pagination"></div>
    </div>
  </div>
</div>

<div id="detail-page" class="hidden">
  <header class="header">
    <div class="max-w-5xl mx-auto px-4 flex justify-between items-center" style="position:relative;">
      <h1 class="logo">Vega<span class="logo-pink">Hub</span>.pro</h1>
      <button onclick="showHome()" class="back-btn ml-auto mr-16">&larr; Home</button> 
      
      <a href="https://t.me/vegahubb" target="_blank" class="tg-icon">
        <img src="https://upload.wikimedia.org/wikipedia/commons/8/82/Telegram_logo.svg" class="w-6 h-6">
      </a>
    </div>
  </header>
  <div> 
    <div class="detail-container">
      <h1 id="detail-title" class="detail-title">Loading...</h1>
      
      <center>
        <img id="detail-poster" class="detail-poster" src="" alt="Poster">
      </center>

      <div id="loader" class="spinner"></div> 
      
      <div id="text-details-container" class="hidden">
          <h2 style="text-align:center; color:var(--text-color); font-size:18px; font-weight:600; margin:10px 0 20px;">Movie Details</h2>
          
          <div class="info-grid">
              <div class="info-item"><div class="info-label">Rating (IMDb)</div><div id="detail-rating" class="info-value">...</div></div>
              <div class="info-item"><div class="info-label">Runtime</div><div id="detail-runtime" class="info-value">...</div></div>
              <div class="info-item"><div class="info-label">Audio/Language</div><div id="detail-language" class="info-value">...</div></div>
              <div class="info-item"><div class="info-label">Genre</div><div id="detail-genres" class="info-value">...</div></div>
              <div class="info-item"><div class="info-label">Year</div><div id="detail-year" class="info-value">...</div></div>
              <div class="info-item"><div class="info-label">Quality</div><div id="detail-quality" class="info-value">...</div></div>
          </div>
          
          <div class="synopsis-box" style="border-left: 3px solid var(--dynamic-primary-gradient-end);">
              <h3 style="color:var(--dynamic-primary-gradient-end);">Cast</h3>
              <p id="detail-cast" class="text-sm text-gray-300">...</p>
          </div>

          <div id="cast-crew-section" class="synopsis-box hidden" style="margin-top:20px;">
              <h3 style="color:var(--dynamic-primary-gradient-end); margin-bottom: 15px;">Cast & Crew</h3>
              <div id="detail-cast-images" class="cast-images-container">
                  </div>
          </div>
          <div class="synopsis-box">
              <h3 style="color:var(--dynamic-primary);">Storyline (Synopsis)</h3>
              <p id="detail-synopsis" style="color:var(--text-color);">...</p>
          </div>
      </div>
      
      <div id="share-section" class="share-container">
          <h3 style="font-size:16px; font-weight:600; margin-bottom:10px; color:var(--dynamic-primary-gradient-end);">Share This Movie</h3>
          <div id="share-buttons">
              </div>
      </div>
      <div id="content-area">
          <h3 style="text-align:center; color:var(--dynamic-primary); font-size:20px; margin:20px 0 10px;">Watch Online</h3> 
          <div class="server-tabs" id="server-tabs"></div>
          
          <div id="content-unavailable" class="empty-state hidden">
              <i class="fas fa-calendar-alt text-4xl mb-4 text-orange-400"></i>
              <h3>Watch/Download Link is Coming Soon!</h3>
              <p>We are currently uploading this content. Please check back later or join our Telegram for instant updates.</p>
              <a href="https://t.me/vegahubpro" target="_blank" class="request-btn">
                  <i class="fab fa-telegram-plane mr-2"></i> Join Telegram Channel
              </a>
          </div>
          
          <div id="player-wrapper">
              <div class="video-container">
                  <iframe id="movie-iframe" src="about:blank" allowfullscreen></iframe>
              </div>
          </div>

          <div id="screenshot-display" class="screenshot-display-container">
              </div>
          
          <h3 style="text-align:center; color:var(--dynamic-primary); font-size:20px; margin:30px 0 15px;">Download Links</h3> 
          <div id="download-buttons"></div>
      </div>
    </div>
  </div>
</div>
<script>
// --- TMDB CONSTANTS UPDATED FOR PROXY ---
// TMDB_API_KEY ‡§ï‡•ã ‡§ñ‡§æ‡§≤‡•Ä ‡§ï‡§∞ ‡§¶‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•à, ‡§ï‡•ç‡§Ø‡•ã‡§Ç‡§ï‡§ø ‡§™‡•ç‡§∞‡•â‡§ï‡•ç‡§∏‡•Ä ‡§∏‡§∞‡•ç‡§µ‡§∞ ‡§á‡§∏‡•á ‡§π‡•à‡§Ç‡§°‡§≤ ‡§ï‡§∞ ‡§∞‡§π‡§æ ‡§π‡•à‡•§
const TMDB_API_KEY = ""; 
// TMDB_BASE_URL ‡§ï‡•ã ‡§Ü‡§™‡§ï‡•á ‡§™‡•ç‡§∞‡•â‡§ï‡•ç‡§∏‡•Ä URL ‡§∏‡•á ‡§¨‡§¶‡§≤‡•á‡§Ç
const TMDB_BASE_URL = "https://easy-karole-virat124-66c2f8da.koyeb.app";
// --------------------------

const MONETAG = "https://is.gd/uiq2DC";
const OMDB_API_KEY = "a4ff55fe"; 
const OMDB_BASE_URL = "https://www.omdbapi.com/";
const DATA_FILE_URL = 'data/movies.json'; 
const YOUTUBE_API_KEY = "AIzaSyDT1RLcB16NDKXhkJrAPG2aeQfb464IGTA"; 
const YOUTUBE_SEARCH_URL = "https://www.googleapis.com/youtube/v3/search";

// Global State for Monetag Redirect Logic (SESSION FLAG)
const MONETAG_SESSION_FLAG = 'monetag_seen_session'; // sessionStorage key
const MONETAG_AD_REDIRECT_URL = MONETAG; 


// Updated Category Color Mapping with Adult and Netflix
const categoryColors = {
  'all': { primary: '#ff1493', secondary: '#ff4500', shadow: 'rgba(255, 20, 147, 0.4)' }, 
  'bollywood': { primary: '#ff9800', secondary: '#ffa07a', shadow: 'rgba(255, 152, 0, 0.6)' }, 
  'hollywood': { primary: '#00bfff', secondary: '#1e90ff', shadow: 'rgba(0, 191, 255, 0.6)' }, 
  'south': { primary: '#32cd32', secondary: '#008000', shadow: 'rgba(50, 205, 50, 0.6)' }, 
  'web': { primary: '#8a2be2', secondary: '#9932cc', shadow: 'rgba(138, 43, 226, 0.6)' }, 
  'adult': { primary: '#ff0000', secondary: '#cc0000', shadow: 'rgba(255, 0, 0, 0.6)' }, 
  'netflix': { primary: '#e50914', secondary: '#b2070a', shadow: 'rgba(229, 9, 20, 0.6)' } 
};


let movies = []; 
let filtered = []; 
let page = 1;
const perPage = 21;
let currentMovie = null;

// NEW: TMDB ID ‡§∏‡•á ‡§°‡•á‡§ü‡§æ ‡§´‡§º‡•á‡§ö ‡§ï‡§∞‡§®‡•á ‡§ï‡§æ ‡§´‡§º‡§Ç‡§ï‡•ç‡§∂‡§® (PROXY READY)
async function fetchTMDBDetails(tmdbId, isTV = false) {
    if (!tmdbId) return null;
    
    const mediaType = isTV ? 'tv' : 'movie';
    // Key ‡§π‡§ü‡§æ ‡§¶‡•Ä ‡§ó‡§à ‡§π‡•à, ‡§ï‡•ç‡§Ø‡•ã‡§Ç‡§ï‡§ø ‡§™‡•ç‡§∞‡•â‡§ï‡•ç‡§∏‡•Ä ‡§á‡§∏‡•á ‡§π‡•à‡§Ç‡§°‡§≤ ‡§ï‡§∞ ‡§∞‡§π‡§æ ‡§π‡•à
    const detailURL = `${TMDB_BASE_URL}/${mediaType}/${tmdbId}?append_to_response=videos,credits`;
    
    try {
        const response = await fetch(detailURL);
        if (!response.ok) throw new Error(`TMDB Proxy HTTP Status ${response.status}`);
        const data = await response.json();
        return data;
    } catch (error) {
        console.error("Critical TMDB Fetch Error via Proxy:", error);
        return null;
    }
}

// Function to fetch JSON data from the server (UNCHANGED)
async function fetchMoviesData() {
    document.getElementById('loading-state').classList.remove('hidden');
    try {
        const response = await fetch(DATA_FILE_URL);
        
        if (!response.ok) {
            console.error(`Failed to fetch data. Status: ${response.status}. Trying to access: ${new URL(DATA_FILE_URL, window.location.href).href}`);
            throw new Error(`Failed to fetch data: ${response.status} ${response.statusText}`);
        }
        
        const data = await response.json(); 
        
        movies = data; 
        filtered = [...movies]; 
        
        if (window.location.hash.startsWith('#movie=')) {
            const imdbId = window.location.hash.substring(7);
            const movieToLoad = findMovieById(imdbId);
            if (movieToLoad) {
                showDetail(movieToLoad, true); 
                history.replaceState({ page: 'detail', movieId: imdbId }, movieToLoad.title, window.location.hash);
            } else {
                render();
            }
        } else {
            render(); 
        }

    } catch (error) {
        // This is the error handler for "Data Error"
        console.error("Critical Error loading movie data:", error);
        const grid = document.getElementById('grid');
        grid.innerHTML = '<div class="empty-state"><i class="fas fa-exclamation-circle text-4xl mb-4 text-red-500"></i><h3>Data Error</h3><p>Could not load movie data file. Check your data/movies.json file path and format (No Comments/Trailing Commas).</p></div>';
    } finally {
        document.getElementById('loading-state').classList.add('hidden');
    }
}

// Movie ID se object dhoondhne ka function (UNCHANGED)
function findMovieById(imdbId) {
    return movies.find(m => m.imdb_id === imdbId);
}

// ------------------- Utility Functions (UNCHANGED) ---------------------

function requestNotificationPermission() {
    if ('Notification' in window) {
        Notification.requestPermission().then(permission => {
            if (permission === 'granted') {
                console.log('Notification permission granted.');
            }
        });
    }
}

function toggleTheme() {
    const body = document.body;
    const themeToggleBtn = document.getElementById('theme-toggle');
    body.classList.toggle('light-mode');
    document.querySelector('.header').classList.toggle('light-mode');
    
    const isLightMode = body.classList.contains('light-mode');
    localStorage.setItem('theme', isLightMode ? 'light' : 'dark');
    
    if (isLightMode) {
        themeToggleBtn.innerHTML = '<i class="fas fa-moon"></i>'; 
    } else {
        themeToggleBtn.innerHTML = '<i class="fas fa-sun"></i>'; 
    }
}

function setCategoryTheme(cat) {
    const theme = categoryColors[cat] || categoryColors['all'];
    document.documentElement.style.setProperty('--dynamic-primary', theme.primary);
    document.documentElement.style.setProperty('--dynamic-primary-gradient-end', theme.secondary);
    document.documentElement.style.setProperty('--dynamic-primary-shadow', theme.shadow);
}

// showHome function ko History API ke saath update kiya gaya (UNCHANGED)
function showHome() {
    document.getElementById('detail-page').classList.add('hidden');
    document.getElementById('home-page').classList.remove('hidden');
    window.scrollTo(0,0);
    
    document.getElementById('search').value = '';
    document.getElementById('empty-search-state').classList.add('hidden');
    document.querySelectorAll('.cat-btn').forEach(x => x.classList.remove('active'));
    document.querySelector('.cat-btn[data-cat="all"]').classList.add('active');
    setCategoryTheme('all'); 
    filtered = [...movies];
    page = 1;
    render();
    
    if (window.location.hash) {
        history.replaceState({ page: 'home' }, 'VegaHub Home', window.location.pathname + window.location.search);
    }
}


async function fetchOMDbDetails(imdbId) {
    if (!imdbId) return null;
    const detailURL = `${OMDB_BASE_URL}?i=${imdbId}&plot=full&apikey=${OMDB_API_KEY}`;
    try {
        const response = await fetch(detailURL);
        if (!response.ok) throw new Error(`HTTP Status ${response.status}`);
        const data = await response.json();
        if (data.Response === "False") {
            console.error("OMDb API Error:", data.Error);
            return null;
        }
        return data;
    } catch (error) {
        console.error("Critical OMDb Fetch Error:", error);
        return null;
    }
}

async function fetchYouTubeTrailer(query) {
    if (!YOUTUBE_API_KEY) {
        console.warn("YouTube API Key is missing.");
        return null;
    }

    const fullQuery = `${query} Official Trailer`;

    const searchUrl = `${YOUTUBE_SEARCH_URL}?key=${YOUTUBE_API_KEY}&part=snippet&q=${encodeURIComponent(fullQuery)}&type=video&maxResults=1`;
    
    try {
        const response = await fetch(searchUrl);
        if (!response.ok) {
            console.error(`YouTube API HTTP Error: ${response.status}`);
            return null;
        }
        const data = await response.json();

        if (data.items && data.items.length > 0 && data.items[0].id.videoId) {
            return data.items[0].id.videoId;
        }
        return null; 
    } catch (error) {
        console.error("YouTube Fetch Error:", error);
        return null;
    }
}

function renderShareButtons(movieTitle, shareUrl) {
    const shareContainer = document.getElementById('share-buttons');
    shareContainer.innerHTML = ''; 

    const encodedUrl = encodeURIComponent(shareUrl);
    const encodedTitle = encodeURIComponent(`Watch ${movieTitle} in HD on VegaHub! - ${shareUrl}`);
    const encodedText = encodeURIComponent(`Watch ${movieTitle} in HD!`);


    const shareLinks = [
        { 
            name: "WhatsApp", 
            icon: "fab fa-whatsapp", 
            class: "share-whatsapp", 
            url: `https://api.whatsapp.com/send?text=${encodedTitle}` 
        },
        { 
            name: "Telegram", 
            icon: "fab fa-telegram-plane", 
            class: "share-telegram", 
            url: `https://t.me/share/url?url=${encodedUrl}&text=${encodedText}` 
        },
        { 
            name: "Twitter", 
            icon: "fab fa-x-twitter", 
            class: "share-twitter", 
            url: `https://twitter.com/intent/tweet?url=${encodedUrl}&text=${encodedText}` 
        },
        { 
            name: "Facebook", 
            icon: "fab fa-facebook-f", 
            class: "share-facebook", 
            url: `https://www.facebook.com/sharer/sharer.php?u=${encodedUrl}&quote=${encodedText}` 
        }
    ];

    shareLinks.forEach(item => {
        const a = document.createElement('a');
        a.href = item.url;
        a.className = `share-btn ${item.class}`;
        a.target = "_blank";
        a.title = `Share on ${item.name}`;
        a.innerHTML = `<i class="${item.icon}"></i>`;
        shareContainer.appendChild(a);
    });
}


// ------------------- showDetail FUNCTION (TMDB PRIMARY LOGIC - PROXY READY) ---------------------

async function showDetail(movie, isPopstate = false) {
    currentMovie = movie;
    document.getElementById('home-page').classList.add('hidden');
    document.getElementById('detail-page').classList.remove('hidden');
    window.scrollTo(0, 0);

    if (!isPopstate) {
        history.pushState({ page: 'detail', movieId: movie.imdb_id }, movie.title, `#movie=${movie.imdb_id}`);
    }

    setCategoryTheme(movie.cat);

    const detailPoster = document.getElementById('detail-poster');
    document.getElementById('loader').classList.remove('hidden');
    document.getElementById('text-details-container').classList.add('hidden');
    document.getElementById('content-area').classList.remove('hidden');
    
    // Cast/Crew section ‡§ï‡•ã ‡§∂‡•Å‡§∞‡•Ç ‡§Æ‡•á‡§Ç ‡§õ‡§ø‡§™‡§æ ‡§¶‡•á‡§Ç
    document.getElementById('cast-crew-section').classList.add('hidden'); 

    document.getElementById('content-unavailable').classList.add('hidden');
    document.getElementById('player-wrapper').classList.remove('hidden');

    document.getElementById('detail-title').textContent = movie.title + ' (Loading Details...)';
    document.getElementById('detail-quality').textContent = movie.quality;

    const initialPosterSrc = movie.thumb_poster || (movie.thumb && movie.thumb !== '' ? movie.thumb : 'https://via.placeholder.com/202x300/111/fff?text=Fetching...');
    detailPoster.src = initialPosterSrc;

    // --- 1. TMDB Fetching (Primary Source) ---
    let tmdbDetails = null;
    let omdbDetails = null; 

    const isTV = movie.cat === 'web' || movie.type === 'tv'; 
    const tmdbId = movie.tmdb_id; 

    if (tmdbId) {
        tmdbDetails = await fetchTMDBDetails(tmdbId, isTV);
    }
    
    // --- 2. OMDB Fetching (Fallback for missing data) ---
    if (movie.imdb_id) {
        omdbDetails = await fetchOMDbDetails(movie.imdb_id);
    }

    // --- 3. Data Population (TMDB > OMDB > Local) ---
    
    let finalMovieTitle = movie.title;
    
    // Get year, title, and synopsis (TMDB always first preference)
    finalMovieTitle = tmdbDetails?.title || tmdbDetails?.name || omdbDetails?.Title || movie.title; 
    const finalYear = tmdbDetails?.release_date ? tmdbDetails.release_date.substring(0, 4) : 
                      tmdbDetails?.first_air_date ? tmdbDetails.first_air_date.substring(0, 4) : 
                      omdbDetails?.Year || movie.year || 'N/A';
                      
    document.getElementById('detail-title').textContent = `${finalMovieTitle} (${finalYear})`;
    
    // Poster (TMDB preferred)
    if (tmdbDetails?.poster_path) {
        detailPoster.src = `https://image.tmdb.org/t/p/w300${tmdbDetails.poster_path}`;
    } else if (omdbDetails?.Poster && omdbDetails.Poster !== 'N/A') {
        detailPoster.src = omdbDetails.Poster;
    } else {
         detailPoster.src = initialPosterSrc;
    }
    
    // Details: TMDB first, then OMDB
    document.getElementById('detail-rating').textContent = (tmdbDetails?.vote_average ? `${tmdbDetails.vote_average.toFixed(1)}/10` : 
                                                           omdbDetails?.imdbRating !== 'N/A' ? `${omdbDetails.imdbRating}/10` : 'N/A');
    
    document.getElementById('detail-year').textContent = finalYear;
    
    document.getElementById('detail-runtime').textContent = (tmdbDetails?.runtime ? `${tmdbDetails.runtime} min` : 
                                                             omdbDetails?.Runtime || 'N/A');
    
    document.getElementById('detail-genres').textContent = (tmdbDetails?.genres ? tmdbDetails.genres.map(g => g.name).join(', ') : 
                                                           omdbDetails?.Genre || 'N/A');
    
    document.getElementById('detail-language').textContent = omdbDetails?.Language || (tmdbDetails?.spoken_languages ? tmdbDetails.spoken_languages.map(l => l.name).join(', ') : 'N/A'); 
    
    document.getElementById('detail-synopsis').textContent = tmdbDetails?.overview || omdbDetails?.Plot || 'Storyline not available.';
    
    // Cast names (text display)
    document.getElementById('detail-cast').textContent = omdbDetails?.Actors || (tmdbDetails?.credits?.cast ? tmdbDetails.credits.cast.slice(0, 5).map(c => c.name).join(', ') : 'N/A');
    
    
    // --- NEW: Cast/Crew Images Rendering (TMDB ONLY) ---
    const castImagesContainer = document.getElementById('detail-cast-images');
    castImagesContainer.innerHTML = '';
    
    if (tmdbDetails && tmdbDetails.credits && tmdbDetails.credits.cast.length > 0) {
        const topCast = tmdbDetails.credits.cast.slice(0, 8); 
        topCast.forEach(member => {
            if (member.profile_path) {
                const castItem = document.createElement('div');
                castItem.className = 'cast-item';
                
                const profilePath = `https://image.tmdb.org/t/p/w185${member.profile_path}`;
                
                castItem.innerHTML = `
                    <img src="${profilePath}" alt="${member.name}" class="cast-image">
                    <div class="cast-name">${member.name}</div>
                    <div class="cast-role">${member.character || 'Crew'}</div>
                `;
                castImagesContainer.appendChild(castItem);
            }
        });
        document.getElementById('cast-crew-section').classList.remove('hidden');
    } else {
        document.getElementById('cast-crew-section').classList.add('hidden');
    }
    

    document.getElementById('loader').classList.add('hidden');
    document.getElementById('text-details-container').classList.remove('hidden');


    // --- 4. Trailer Fetch and Integration (TMDB > YouTube Fallback) ---
    
    let videoId = null;
    let trailerLink = null;
    
    // Primary: Check TMDB videos first
    if (tmdbDetails && tmdbDetails.videos && tmdbDetails.videos.results.length > 0) {
        const trailer = tmdbDetails.videos.results.find(v => v.type === "Trailer" && v.site === "YouTube");
        if (trailer) {
            videoId = trailer.key;
        }
    }
    
    // Fallback: If TMDB has no trailer, go to YouTube Search API
    if (!videoId) {
        const movieSearchQuery = `${finalMovieTitle} ${finalYear} Official Trailer`;
        videoId = await fetchYouTubeTrailer(movieSearchQuery);
    }
    
    const serversWithTrailer = [];
    if (videoId) {
        trailerLink = `https://www.youtube.com/embed/${videoId}?autoplay=0&rel=0`;
        serversWithTrailer.push({ name: "Official Trailer", link: trailerLink, type: 'trailer' });
    }

    if (movie.servers && movie.servers.length > 0) {
        serversWithTrailer.push(...movie.servers.map(s => ({...s, type: 'watch'})));
    }
    
    
    // --- Share Button Rendering ---
    const currentShareUrl = window.location.origin + window.location.pathname + `#movie=${movie.imdb_id}`;
    renderShareButtons(finalMovieTitle, currentShareUrl);

    
    // --- Content Check and Rendering (Original Logic) ---
    const hasServers = serversWithTrailer.length > 0;
    const hasDownloads = movie.downloads && Object.keys(movie.downloads).some(key => movie.downloads[key].link && movie.downloads[key].link !== '#');

    const tabs = document.getElementById('server-tabs');
    const iframe = document.getElementById('movie-iframe');
    const dl = document.getElementById('download-buttons');
    
    tabs.innerHTML = '';
    dl.innerHTML = '';

    if (!hasServers && !hasDownloads) {
        document.getElementById('content-unavailable').classList.remove('hidden');
        document.getElementById('player-wrapper').classList.add('hidden'); 
        tabs.innerHTML = '<div style="color:var(--text-color); text-align:center; font-style:italic;">No servers available yet.</div>';
        dl.innerHTML = '<div style="color:var(--text-color); text-align:center; font-style:italic;">Download links are coming soon.</div>';
    } else {
        document.getElementById('content-unavailable').classList.add('hidden');
        document.getElementById('player-wrapper').classList.remove('hidden');
        
        // --- Server Tabs Logic (Using serversWithTrailer) ---
        let activeLink = 'about:blank';
        if (hasServers) {
            serversWithTrailer.forEach((server, index) => {
                const btn = document.createElement('div');
                const isActive = (index === 0);
                
                btn.className = 'server-tab' + (isActive ? ' active':'');
                btn.textContent = server.name;

                btn.setAttribute('data-target-url', server.link);
                btn.setAttribute('data-target-type', server.type || 'watch');

                if ((server.type || 'watch') === 'watch') {
                    btn.addEventListener('click', handleFirstClickMonetag); 
                } else {
                    btn.onclick = () => {
                        document.querySelectorAll('.server-tab').forEach(t => t.classList.remove('active'));
                        btn.classList.add('active');
                        iframe.src = server.link;
                    };
                }
                tabs.appendChild(btn);

                if (isActive) {
                    activeLink = server.link;
                }
            });
            
            iframe.src = activeLink;
            
            const defaultActiveServer = serversWithTrailer.find(s => s.link === activeLink);
            if (defaultActiveServer && defaultActiveServer.type !== 'trailer') {
                iframe.src = defaultActiveServer.link;
            }

        } else {
            tabs.innerHTML = '<div style="color:var(--text-color); text-align:center; font-style:italic;">No watch servers available yet.</div>';
            iframe.src = 'about:blank';
        }

        // --- Download Buttons (Original Logic) ---
        if (hasDownloads) {
            Object.keys(movie.downloads).forEach(qKey => {
                const downloadData = movie.downloads[qKey];
                const link = downloadData.link;
                const labelText = downloadData.label; 

                if(link && link !== "#") {
                    const a = document.createElement('a');
                    a.href = link;
                    a.className = 'download-btn monetag-trigger';
                    a.textContent = labelText; 
                    a.setAttribute('data-target-url', link); 
                    a.setAttribute('data-target-type', 'download');
                    dl.appendChild(a);
                }
            });
            attachMonetagTrigger();
            
        } else {
            dl.innerHTML = '<div style="color:var(--text-color); text-align:center; font-style:italic;">Download links are coming soon.</div>';
        }
    }

    // --- Screenshot Display Logic (Original Logic) ---
    const screenshotDisplay = document.getElementById('screenshot-display');
    screenshotDisplay.innerHTML = '';

    const links = movie.screenshots;

    if (Array.isArray(links) && links.length > 0) {
        screenshotDisplay.innerHTML += `<h3 class="screenshot-heading" style="color:var(--dynamic-primary);">Movie Screenshots</h3>`;
        
        const imagesContainer = document.createElement('div');
        imagesContainer.className = 'screenshot-images-wrapper stacked-view'; 
        
        links.forEach(link => { 
            if (link && typeof link === 'string' && link !== '#') {
                const img = document.createElement('img');
                img.src = link;
                img.className = 'movie-screenshot-img';
                img.alt = `Screenshot of ${movie.title}`;
                imagesContainer.appendChild(img);
            }
        });
        screenshotDisplay.appendChild(imagesContainer);
    }
}

// -----------------------------------------------------------------------
// CORE FUNCTION: Per-Session First-Click Monetag Logic (UNCHANGED)
// -----------------------------------------------------------------------

function handleFirstClickMonetag(event) {
    event.preventDefault(); 
    
    const element = event.currentTarget; 
    const targetUrl = element.getAttribute('data-target-url');
    
    if (!targetUrl) return;

    // CHECK: sessionStorage ‡§Æ‡•á‡§Ç Flag ‡§¶‡•á‡§ñ‡•á‡§Ç
    const monetagSeen = sessionStorage.getItem(MONETAG_SESSION_FLAG);

    if (!monetagSeen) {
        // --- 1. FIRST CLICK (Session): Show Ad ---
        
        // SET: Ad ‡§¶‡•á‡§ñ‡§®‡•á ‡§ï‡•á ‡§¨‡§æ‡§¶, Flag ‡§ï‡•ã sessionStorage ‡§Æ‡•á‡§Ç ‡§∏‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç
        sessionStorage.setItem(MONETAG_SESSION_FLAG, 'true');
        
        // Fake History Entry push ‡§ï‡§∞‡•á‡§Ç
        history.pushState({ page: 'ad-redirect', type: 'monetag-interstitial', initialPage: window.location.href }, 'Ad Gateway', window.location.href);
        
        // user ‡§ï‡•ã Monetag ad URL ‡§™‡§∞ redirect ‡§ï‡§∞‡•á‡§Ç
        window.location.href = MONETAG_AD_REDIRECT_URL; 
        
    } else {
        // --- 2. SUBSEQUENT CLICK (Same Session): Go to Actual Target ---
        
        const targetType = element.getAttribute('data-target-type');
        
        if (targetType === 'download') {
             // Download links ‡§ï‡•ã ‡§®‡§è ‡§ü‡•à‡§¨ ‡§Æ‡•á‡§Ç ‡§ì‡§™‡§® ‡§ï‡§∞‡•á‡§Ç
             window.open(targetUrl, '_blank');
        } else if (targetType && targetType.startsWith('watch')) {
            // Watch links ‡§ï‡•ã iframe ‡§Æ‡•á‡§Ç load ‡§ï‡§∞‡•á‡§Ç
            const iframe = document.getElementById('movie-iframe');
            if (iframe) {
                 iframe.src = targetUrl;
                 // UI ‡§Ö‡§™‡§°‡•á‡§ü: Active tab ‡§∏‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç
                 document.querySelectorAll('.server-tab').forEach(t => t.classList.remove('active'));
                 element.classList.add('active');
            }
        }
    }
}


function attachMonetagTrigger() {
    // Select all download buttons created above
    const buttons = document.querySelectorAll('.download-btn.monetag-trigger');

    buttons.forEach(button => {
        if (button.hasAttribute('data-listener-attached')) return;
        
        // Session First-Click Handler ‡§≤‡§ó‡§æ‡§è‡§Ç
        button.addEventListener('click', handleFirstClickMonetag); 
        button.setAttribute('data-listener-attached', 'true');
    });
}


// ------------------- General Functions (UPDATED RENDER for TMDB Poster Fallback) ---------------------

async function render() {
  const g = document.getElementById('grid');
  g.innerHTML = '';
  document.getElementById('empty-search-state').classList.add('hidden'); 
  
  const start = (page-1)*perPage;
  const end = Math.min(start + perPage, filtered.length);

  if (filtered.length === 0 && movies.length > 0) {
      document.getElementById('empty-search-state').classList.remove('hidden');
      renderPagination(0); 
      return;
  }
  if (movies.length === 0) return; 

  for(let i=start; i<end; i++) {
    const m = filtered[i];
    const d = document.createElement('div');
    d.className = 'card';
    
    let cardThumbSrc = m.thumb_poster || (m.thumb && m.thumb !== '' ? m.thumb : '');
    
    // --- NEW: TMDB/OMDb Poster Fetch Logic (Optimized for Home Page) ---
    if ((!m.thumb || m.thumb === 'https://thisisabrokenlink.com/404.jpg') && (m.tmdb_id || m.imdb_id) && !m.thumb_poster) {
        
        let posterFound = false;
        
        // 1. TMDB ‡§∏‡•á Poster Fetch ‡§ï‡§∞‡§®‡•á ‡§ï‡§æ ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç
        if (m.tmdb_id) {
             const tmdbId = m.tmdb_id;
             const isTV = m.cat === 'web' || m.type === 'tv'; 
             const mediaType = isTV ? 'tv' : 'movie';
             // Key ‡§π‡§ü‡§æ ‡§¶‡•Ä ‡§ó‡§à ‡§π‡•à
             const tmdbPosterURL = `${TMDB_BASE_URL}/${mediaType}/${tmdbId}`; 
             try {
                const response = await fetch(tmdbPosterURL);
                if (response.ok) {
                    const posterData = await response.json();
                    if (posterData.poster_path) {
                        m.thumb_poster = `https://image.tmdb.org/t/p/w300${posterData.poster_path}`;
                        cardThumbSrc = m.thumb_poster;
                        // TMDB ‡§∞‡•á‡§ü‡§ø‡§Ç‡§ó ‡§≠‡•Ä ‡§≤‡•á‡§Ç
                        if (posterData.vote_average) {
                            m.imdb_rating = posterData.vote_average.toFixed(1);
                        }
                        posterFound = true;
                    }
                }
             } catch (e) { console.error("TMDB Home Poster Error via Proxy:", e); }
        }
        
        // 2. ‡§Ö‡§ó‡§∞ TMDB ‡§∏‡•á ‡§™‡•ã‡§∏‡•ç‡§ü‡§∞ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ, ‡§§‡•ã OMDb ‡§∏‡•á fetch ‡§ï‡§∞‡•á‡§Ç
        if (!posterFound && m.imdb_id) {
            const omdbDetails = await fetchOMDbDetails(m.imdb_id);
            if (omdbDetails && omdbDetails.Poster && omdbDetails.Poster !== 'N/A') {
                m.thumb_poster = omdbDetails.Poster; 
                cardThumbSrc = omdbDetails.Poster;
            } else {
                m.thumb_poster = 'https://via.placeholder.com/300x420/111/fff?text=No+Poster';
                cardThumbSrc = m.thumb_poster;
            }
            if (omdbDetails && omdbDetails.imdbRating && omdbDetails.imdbRating !== 'N/A') {
                m.imdb_rating = omdbDetails.imdbRating;
            } else {
                m.imdb_rating = null;
            }
        }
    } else if (!cardThumbSrc || cardThumbSrc === 'https://thisisabrokenlink.com/404.jpg') {
        cardThumbSrc = 'https://via.placeholder.com/300x420/111/fff?text=Poster+Missing';
    }


    const movieYear = m.year ? `(${m.year})` : '';

    d.innerHTML = `
      <img src="${cardThumbSrc}" class="thumb" onerror="this.src='https://via.placeholder.com/300x420/111/fff?text=${encodeURIComponent(m.title)}+Broken'" data-loaded-src="${cardThumbSrc}">
      <div class="quality">${m.quality}</div>
      ${m.imdb_rating ? `<div class="rating-badge"><i class="fas fa-star text-yellow-400"></i> ${m.imdb_rating}</div>` : ''}
      <div class="p-2 text-center"> 
          <div class="text-pink-400 font-extrabold text-xs leading-tight">${m.title}</div> 
          <div class="text-orange-400 text-[10px] mt-1">${movieYear}</div> 
      </div>
    `;
    d.onclick = () => showDetail(m); // Normal click will push state
    g.appendChild(d);
  }
  renderPagination(filtered.length);
}

function renderPagination(totalItems = filtered.length) { 
  const total = Math.ceil(totalItems / perPage);
  const p = document.getElementById('pagination');
  p.innerHTML = '';
  
  if(total <= 1) return; 

  if(page > 1) p.innerHTML += `<button class="page-btn" onclick="page--;render()">Previous</button>`;
  for(let i=1; i<=total; i++){
    if(i===1 || i===total || Math.abs(i-page)<=2){
      p.innerHTML += `<button class="page-btn ${i===page?'active':''}" onclick="page=${i};render()">${i}</button>`;
    } else if(Math.abs(i-page)===3) p.innerHTML += `<span class="px-1 text-gray-400 text-sm">...</span>`;
  }
  if(page < total) p.innerHTML += `<button class="page-btn" onclick="page++;render()">Next</button>`;
}

document.querySelectorAll('.cat-btn').forEach(b => b.onclick = () => {
  document.querySelectorAll('.cat-btn').forEach(x => x.classList.remove('active'));
  b.classList.add('active');
  const c = b.dataset.cat;
  
  setCategoryTheme(c); 
  
  filtered = c === 'all' ? [...movies] : movies.filter(x => x.cat === c);
  page = 1; render();
});

document.getElementById('search').addEventListener('input', e => {
  filtered = movies.filter(m => m.title.toLowerCase().includes(e.target.value.toLowerCase()));
  page = 1; render();
});

// ------------------- INITIALIZATION & HISTORY HANDLERS ---------------------

document.addEventListener('DOMContentLoaded', () => {
    fetchMoviesData(); 
    requestNotificationPermission();

    const themeToggleBtn = document.getElementById('theme-toggle');
    const header = document.querySelector('.header');
    
    if (localStorage.getItem('theme') === 'light') {
        document.body.classList.add('light-mode');
        header.classList.add('light-mode'); 
        themeToggleBtn.innerHTML = '<i class="fas fa-moon"></i>';
    } else {
        themeToggleBtn.innerHTML = '<i class="fas fa-sun"></i>';
    }
    document.getElementById('theme-toggle').onclick = toggleTheme;
    
    setCategoryTheme('all');
    
    // CRITICAL FIX: Back button (browser/mobile) press ko handle karne ke liye
    window.addEventListener('popstate', (event) => {
        
        // --- Handle Ad Redirection Back Click ---
        if (event.state && event.state.page === 'ad-redirect') {
            console.log("Returned from Monetag Ad. User must click again for actual content.");
        }
        // --- END Ad Redirection Handler ---


        // Existing Logic (Detail/Home navigation)
        if (!window.location.hash || (event.state && event.state.page === 'home')) {
            showHome();
        } else if (event.state && event.state.page === 'detail') {
            const movieToLoad = findMovieById(event.state.movieId);
            if (movieToLoad) {
                showDetail(movieToLoad, true); 
            } else {
                showHome();
            }
        } else {
            showHome();
        }
    });

});

// ------------------- VID SRC HD ‚Äî DIRECT PLAYER (UNCHANGED) ---------------------

const vidsrcDirectMirrors = [
  'https://vidsrc-embed.ru',
  'https://vidsrc-embed.su',
  'https://vidsrcme.su',
  'https://vsrc.su', 
];

document.addEventListener('DOMContentLoaded', () => {
  const originalShowDetail = window.showDetail;

  window.showDetail = async function(movie, isPopstate = false) {
    // 1. Original showDetail logic ‡§ö‡§≤‡§æ‡§ì 
    if (typeof originalShowDetail === 'function') {
        await originalShowDetail(movie, isPopstate);
    } 
    

    if (!movie.imdb_id) return;

    const tabs = document.getElementById('server-tabs');
    // Guard clause to prevent duplicating the button
    if (!tabs || tabs.querySelector('.vidsrc-direct-btn')) {
        return; 
    }

    const btn = document.createElement('div');
    btn.className = 'server-tab vidsrc-direct-btn active';
    btn.innerHTML = 'WATCH FULL MOVIE <span style="color:yellow;font-size:9px">HD DIRECT</span>';
    btn.style.cssText = 'background: linear-gradient(135deg, #00ff9d, #00c853) !important; font-weight: 700; padding: 8px 12px; margin: 4px; border-radius: 6px; cursor: pointer;';

    const imdbId = movie.imdb_id.startsWith('tt') ? movie.imdb_id : 'tt' + movie.imdb_id;
    const isTV = movie.cat === 'web' || movie.type === 'tv';
    
    const randomIndex = Math.floor(Math.random() * vidsrcDirectMirrors.length);
    const randomBase = vidsrcDirectMirrors[randomIndex];
    
    let directLink;

    if (isTV) {
        directLink = `${randomBase}/embed/tv/${imdbId}/1/1`;
    } else {
        directLink = `${randomBase}/embed/movie/${imdbId}`;
    }
    
    // Vidsrc ‡§™‡§∞ ‡§≠‡•Ä Monetag First-Click Logic ‡§≤‡§æ‡§ó‡•Ç ‡§ï‡§∞‡•á‡§Ç
    btn.setAttribute('data-target-url', directLink);
    btn.setAttribute('data-target-type', 'download'); // Treat as download/external link for window.open
    
    // Global First-Click Handler ‡§≤‡§ó‡§æ‡§è‡§Ç
    btn.addEventListener('click', handleFirstClickMonetag);


    // Button ‡§ï‡•ã tabs ‡§Æ‡•á‡§Ç ‡§ú‡•ã‡§°‡§º‡•ã
    tabs.appendChild(btn);

    // Agar movie mein koi server nahi hai ‚Üí auto open kar do
    if (!movie.servers || movie.servers.length === 0) {
      setTimeout(() => {
          // sessionStorage ‡§∏‡•á ‡§ö‡•á‡§ï ‡§ï‡§∞‡•á‡§Ç
          if (!sessionStorage.getItem(MONETAG_SESSION_FLAG)) {
               // Ad ‡§®‡§π‡•Ä‡§Ç ‡§¶‡•á‡§ñ‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•à, ‡§§‡•ã Ad flow ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•ã
               btn.click(); 
          } else {
               // Ad ‡§¶‡•á‡§ñ‡§æ ‡§ú‡§æ ‡§ö‡•Å‡§ï‡§æ ‡§π‡•à, ‡§§‡•ã Vidsrc link ‡§∏‡•Ä‡§ß‡•á ‡§ñ‡•ã‡§≤ ‡§¶‡•ã
               window.open(directLink, '_blank');
          }
      }, 1200);
    }
  };
});
</script>


</body>
</html>
